<h1>finalizer와 cleaner사용을 피하라</h1>

- 자바는 두가지 객체 소멸자를 제공한다. finalizer와 cleaner이다.
- finalizer는 예측할 수 없고 상황에 따라 위험할 수 있어 일반적으로 불필요하다. 자바 9에서 대안으로 cleaner를 내놓았지만 이도 여전히 예측할 수 없고 느리고 일반적으로 불필요하다.

<h2>finalizer/cleaner 사용의 위험</h2>

- 객체 접근을 할 수 없게 된 후 finalizer와 cleaner가 실행되기까지 얼마나 걸릴지 알수 없고 제때 실행되어야 하는 작업은 절대 할 수 없다.
- 상태를 영구적으로 수정하는 작업에서는 절대 finalize나 cleaner에 의존해서는 안 된다.
- finalize나 cleaner는 심각한 성능 문제도 동반한다.
- finalzie를 사용한 클래스는 finalize 공격에 노출되어 심각한 보안 문제를 일으킬 수 있다.
    - finalize는 정적 필드에 자신의 참조를 할당하여 가비지 컬렉터가 수집하지 못하게 막을 수 있다. 
    - 객체 생성을 막으려면 생성자에 예외를 던지는 것으로 충분하지만 finalize가 있는 경운느 그렇지 않다.
    - final이 아닌 클래스를 finalizer 공격으로부터 방어하려면 아무일도 하지 않는 finalize 메서드를 만들고 final로 선언하자

<h2>finalizer/cleaner 를 대신해줄 묘안 AutoCloseable</h2>

- AutoCloseable를 구현해주고 클라이언트나 인스턴스를 다쓰고 나면 close 메서드를 호출하면 된다.
- 각 인스턴스는 자신이 닫혔는지를 추적하는 것이 좋다. 즉 close 메서드에서 이 객체는 더 이상 유효하지 않음을 필드에 기록하고 다른 메서드는 이 필드를 검사해서 객체가 닫힌 후에 불렸다면 예외를 던지는 것이다.

<h2>finalizer/cleaner는 어디에 사용하는 것일까?</h2>

- 첫째, 자원의 소유자가 close메서드를 호출하지 않는 것에 대비한 안전망 역할이다.
    - 클라이언트가 하지 않은 자원 회수를 늦게라도 해주는 것이 아에 안하는 것보다는 낫다.

- 둘째, 네이티브 피어(일반 자바 객체가 네이티브 메서드를 통해 기능을 위임한 네이티브 객체)와 연결된 객체에서다. 
    - 네이티브 피어는 자바 객체가 아니니 가비지 컬렉터는 그 존재를 알지 못한다. 그러므로 cleaner나 finalizer가 나서서 처리하기에 적당한 작업이다.
    - 단, 성능 저하를 감당할 수 있고 네이티브 피어가 심각한 자원을 가지고 있지 않을 때에만 해당된다.